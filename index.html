<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friday IA | Plataforma Profissional de IA</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        :root {
            --primary-color: #2563eb;
            --secondary-color: #4f46e5;
            --background-dark: #0f172a;
            --text-primary: #1e293b;
        }

        * {
            font-family: 'Inter', system-ui, sans-serif;
        }

        body {
            background: var(--background-dark);
            color: var(--text-primary);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 1rem;
        }

        .glass-morphism {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .message-transition {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .feature-card {
            background: linear-gradient(45deg, rgba(37,99,235,0.1) 0%, rgba(79,70,229,0.1) 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .typing-indicator span {
            width: 5px;
            height: 5px;
            background: currentColor;
            display: inline-block;
            border-radius: 50%;
            animation: typing 1s infinite;
            margin: 0 2px;
        }

        @keyframes typing {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        .nav-item:hover {
            background: rgba(37,99,235,0.1);
            transform: translateX(4px);
        }

        .sidebar-heading {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #64748b;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function Chat() {
            const [messages, setMessages] = useState([]);
            const [input, setInput] = useState('');
            const [loading, setLoading] = useState(false);
            const messagesEndRef = useRef(null);

            useEffect(() => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            }, [messages]);

            useEffect(() => {
                // Função para consultar o conteúdo no Firestore
                const fetchContent = async () => {
                    try {
                        const response = await fetch('http://127.0.0.1:8080/consultar_base_dados', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ documento: 'linha_1' })
                        });
                        const data = await response.json();

                        let conteudo = data.conteudo;
                        // Decodificar os caracteres Unicode
                        conteudo = JSON.parse('"' + conteudo.replace(/"/g, '\\"') + '"');
                        
                        // Adicionar a mensagem de resposta ao estado
                        setMessages(prev => [...prev, { role: 'assistant', content: conteudo, timestamp: new Date().toLocaleTimeString() }]);
                    } catch (error) {
                        console.error('Erro ao consultar base de dados:', error);
                        setMessages(prev => [...prev, {
                            role: 'assistant',
                            content: 'Ocorreu um erro ao buscar o conteúdo.',
                            timestamp: new Date().toLocaleTimeString()
                        }]);
                    }
                };

                fetchContent();
            }, []);  // Isso vai ser chamado uma vez, após o componente ser montado

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!input.trim()) return;

                const userMessage = { role: 'user', content: input, timestamp: new Date().toLocaleTimeString() };
                setMessages(prev => [...prev, userMessage]);
                setInput('');
                setLoading(true);

                try {
                    const response = await fetch('https://7bfa-34-32-136-66.ngrok-free.app', { // URL ajustada
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify({ pergunta: input }) // Alinha com o backend
                    });

                    const data = await response.json();
                    const aiMessage = {
                        role: 'assistant',
                        content: data.resposta || "Não foi possível processar sua solicitação.",
                        timestamp: new Date().toLocaleTimeString()
                    };
                    setMessages(prev => [...prev, aiMessage]);
                } catch (error) {
                    console.error('Error:', error);
                    setMessages(prev => [...prev, {
                        role: 'assistant',
                        content: 'Ocorreu um erro na comunicação. Tente novamente.',
                        timestamp: new Date().toLocaleTimeString()
                    }]);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="min-h-screen p-4">
                    <div className="dashboard-grid h-[calc(100vh-2rem)]">
                        {/* Sidebar */}
                        <div className="glass-morphism rounded-2xl p-6 flex flex-col">
                            <div className="flex items-center space-x-3 mb-8">
                                <div className="w-10 h-10 rounded-full bg-gradient-to-r from-blue-600 to-indigo-600 flex items-center justify-center">
                                    <i className="fas fa-robot text-white"></i>
                                </div>
                                <div>
                                    <h1 className="font-bold text-xl">Friday IA</h1>
                                    <p className="text-sm text-gray-600">Enterprise Edition</p>
                                </div>
                            </div>

                            <nav className="space-y-6 flex-1">
                                <div>
                                    <h2 className="sidebar-heading mb-3">Navegação</h2>
                                    <div className="space-y-1">
                                        <div className="nav-item flex items-center space-x-3 p-3 rounded-lg cursor-pointer transition-all">
                                            <i className="fas fa-home text-gray-600"></i>
                                            <span>Dashboard</span>
                                        </div>
                                        <div className="nav-item flex items-center space-x-3 p-3 rounded-lg cursor-pointer transition-all bg-blue-50">
                                            <i className="fas fa-comments text-blue-600"></i>
                                            <span className="text-blue-600 font-medium">Chat IA</span>
                                        </div>
                                        <div className="nav-item flex items-center space-x-3 p-3 rounded-lg cursor-pointer transition-all">
                                            <i className="fas fa-cog text-gray-600"></i>
                                            <span>Configurações</span>
                                        </div>
                                    </div>
                                </div>
                            </nav>
                        </div>

                        {/* Main Chat Area */}
                        <div className="glass-morphism rounded-2xl flex flex-col">
                            <div className="border-b p-6">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <h2 className="text-xl font-bold">Chat Interativo</h2>
                                        <p className="text-sm text-gray-600">Assistente IA Profissional</p>
                                    </div>
                                </div>
                            </div>

                            <div className="flex-1 overflow-y-auto p-6 space-y-6">
                                {messages.length === 0 && (
                                    <div className="text-center py-12">
                                        <div className="w-16 h-16 mx-auto bg-blue-100 rounded-full flex items-center justify-center mb-4">
                                            <i className="fas fa-robot text-blue-600 text-2xl"></i>
                                        </div>
                                        <h3 className="text-lg font-medium mb-2">Bem-vindo à Friday IA</h3>
                                        <p className="text-gray-600">Como posso auxiliar você hoje?</p>
                                    </div>
                                )}

                                {messages.map((msg, index) => (
                                    <div key={index} 
                                        className={`flex items-end ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                        <div className={`message-transition max-w-[70%] ${
                                            msg.role === 'user' 
                                                ? 'bg-blue-600 text-white rounded-t-2xl rounded-l-2xl' 
                                                : 'bg-gray-100 text-gray-800 rounded-t-2xl rounded-r-2xl'
                                        } p-4 shadow-sm`}>
                                            <div className="mb-1">{msg.content}</div>
                                            <div className={`text-xs ${msg.role === 'user' ? 'text-blue-100' : 'text-gray-500'}`}>
                                                {msg.timestamp}
                                            </div>
                                        </div>
                                    </div>
                                ))}

                                {loading && (
                                    <div className="flex items-start">
                                        <div className="bg-gray-100 rounded-t-2xl rounded-r-2xl p-4">
                                            <div className="typing-indicator">
                                                <span></span>
                                                <span style={{animationDelay: '0.2s'}}></span>
                                                <span style={{animationDelay: '0.4s'}}></span>
                                            </div>
                                        </div>
                                    </div>
                                )}
                                <div ref={messagesEndRef} />
                            </div>

                            <div className="p-6 border-t">
                                <form onSubmit={handleSubmit} className="flex space-x-4">
                                    <div className="flex-1 relative">
                                        <input
                                            type="text"
                                            value={input}
                                            onChange={(e) => setInput(e.target.value)}
                                            placeholder="Digite sua mensagem..."
                                            className="w-full px-6 py-4 rounded-xl border bg-gray-50 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            disabled={loading}
                                        />
                                    </div>
                                    <button
                                        type="submit"
                                        disabled={loading || !input.trim()}
                                        className="px-8 py-4 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2"
                                    >
                                        {loading ? (
                                            <i className="fas fa-circle-notch fa-spin"></i>
                                        ) : (
                                            <span>Enviar</span>
                                        )}
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<Chat />);
    </script>
</body>
</html>

